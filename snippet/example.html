<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example</title>
    <script src="./console-override.js"></script>
  </head>
  <body>
    <script>
      function setEnvironment() {
        const envSelect = document.getElementById('env');
        const selectedEnv = envSelect.value;
        localStorage.setItem('_vp_snippet_env', selectedEnv);
        console.log(`Environment set to: ${selectedEnv}`);
        showConfigData();
      }

      function setSdkKey() {
        const sdkKeyInput = document.getElementById('sdkKeyInput');
        const sdkKey = sdkKeyInput.value;
        localStorage.setItem('_vp_snippet_sdk_key', sdkKey);
        console.log(`SDK Key set to: ${sdkKey}`);
        showConfigData();
      }
    </script>
    <div style="margin-bottom: 10px;">
      <button id="show">Show Survey</button>
      <button id="hide">Hide Survey</button>
      <button id="clear">Clear Storage</button>
      <button id="reload">Reload</button>
    </div>
    <div>
      <select id="env" style="min-width: 80px; min-height: 22px;" onchange="setEnvironment()">
        <option value="dev">/s/dev/</option>
        <option value="prod">/s/</option>
      </select>
      <input type="text" id="sdkKeyInput" placeholder="Enter SDK Key">
      <button onclick="setSdkKey()">Save</button>
    </div>
    <pre id="current-snippet"></pre>
    <pre id="storage-display"></pre>
    <pre id="config-display"></pre>
    <script>
      const defaults = {
        _vp_snippet_sdk_key: 'testsdkkey1',
        _vp_snippet_env: 'dev'
      };

      Object.keys(defaults).forEach((key) => {
        if (localStorage.getItem(key) === null) {
          localStorage.setItem(key, defaults[key]);
        }
      });
    </script>
    <script>
      (function initializeEnvironment() {
        const envSelect = document.getElementById('env');
        const storedEnv = localStorage.getItem('_vp_snippet_env');
        if (storedEnv) {
          envSelect.value = storedEnv;
        }
      })();
    </script>
    <script>
      const sdkKey = localStorage.getItem('_vp_snippet_sdk_key');
      const env = localStorage.getItem('_vp_snippet_env') === 'dev" ? "/s/dev/" : "/s/";

      if (sdkKey && baseUrl) {
        const script = document.createElement('script');
        script.src = `${baseUrl}${env}${sdkKey}.js`;

        const currentScript = document.currentScript;
        currentScript.parentNode.insertBefore(script, currentScript.nextSibling);
      }
    </script>
    <script>
      document.getElementById("clear").onclick = function() {
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('_vp')) {
            localStorage.removeItem(key);
            i--; // Adjust index after removing item
          }
        }
        window.location.reload();
      };
    </script>
    <script>
      document.getElementById("show").onclick = function() {
        const voicepanel = Voicepanel.init();
        voicepanel.showSurvey("csat_survey");
      };
    </script>
    <script>
      document.getElementById("hide").onclick = function() {
        const voicepanel = Voicepanel.init();
        voicepanel.hideSurvey("csat_survey");
      };
    </script>
    <script>
      document.getElementById("reload").onclick = function() {
        window.location.reload();
      };
    </script>
    <script>
      function showConfigData() {
        var configJson = JSON.stringify(window.voicepanelConfig || {}, null, 2);

        document.getElementById("config-display").innerHTML = `config: ${configJson}`;

        var storageOutput = '';
        for (var i = 0; i < localStorage.length; i++) {
          var key = localStorage.key(i);

          if (key.startsWith('_vp')) {
            var rawValue = localStorage.getItem(key);
            var value;

            try {
              var jsonValue = JSON.parse(rawValue);
              value = JSON.stringify(jsonValue, null, 2);
            } catch (e) {
              value = rawValue;
            }
          storageOutput += key + ': ' + value + '\n';
          }
        }

        document.getElementById("storage-display").innerHTML = storageOutput;
      }
      showConfigData();
    </script>
  </body>
</html>
